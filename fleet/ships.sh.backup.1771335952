#!/usr/bin/env bash

ACCESS="nostromo"
BOOT_SOUND="$HOME/.config/fast2/boot.mp3"

SOFT_GREEN="\033[38;5;28m"
DIM_GREEN="\033[38;5;22m"
RED="\033[38;5;196m"
RESET="\033[0m"

typewriter() {
  text="$1"
  for (( i=0; i<${#text}; i++ )); do
    printf "%b%s%b" "$SOFT_GREEN" "${text:$i:1}" "$RESET"
    sleep 0.01
  done
  printf "\n"
}

center_text() {
  termwidth=$(tput cols)
  padding=$(( (termwidth - ${#1}) / 2 ))
  printf "%*s%s\n" $padding "" "$1"
}

clear
printf "\033[?25l"

# ---- Boot Animation ----
typewriter "Initializing Weyland-Yutani Fleet Registry..."
sleep 0.4
typewriter "Scanning deep space transmissions..."
sleep 0.4
typewriter "Decrypting ship manifests..."
sleep 0.4

# ---- Large Centered ASCII Banner ----
clear
echo
center_text "██╗    ██╗███████╗██╗   ██╗██╗      █████╗ ███╗   ██╗██████╗"
center_text "██║    ██║██╔════╝╚██╗ ██╔╝██║     ██╔══██╗████╗  ██║██╔══██╗"
center_text "██║ █╗ ██║█████╗   ╚████╔╝ ██║     ███████║██╔██╗ ██║██║  ██║"
center_text "██║███╗██║██╔══╝    ╚██╔╝  ██║     ██╔══██║██║╚██╗██║██║  ██║"
center_text "╚███╔███╔╝███████╗   ██║   ███████╗██║  ██║██║ ╚████║██████╔╝"
center_text " ╚══╝╚══╝ ╚══════╝   ╚═╝   ╚══════╝╚═╝  ╚═╝╚═╝  ╚═══╝╚═════╝ "
echo
sleep 0.5

# ---- Biometric Scan ----
center_text "BIOMETRIC AUTHENTICATION REQUIRED"
sleep 0.5

printf "\n"
printf "${DIM_GREEN}"
center_text "[ SCANNING RETINAL PATTERN ]"
printf "${RESET}"
sleep 1

# ---- Login Attempts ----
ATTEMPTS=3

while [ $ATTEMPTS -gt 0 ]; do
  printf "\n"
  printf "${SOFT_GREEN}"
  center_text "ENTER FLEET ACCESS CODE:"
  printf "${RESET}"
  read -s CODE
  echo

  if [ "$CODE" = "$qqqq" ]; then
    center_text "ACCESS GRANTED"
    sleep 1
    break
  else
    ATTEMPTS=$((ATTEMPTS-1))
    center_text "ACCESS DENIED — Attempts Remaining: $ATTEMPTS"
    sleep 1
  fi

  if [ $ATTEMPTS -eq 0 ]; then
    center_text "SECURITY LOCKDOWN INITIATED"
    sleep 2
    printf "\033[?25h"
    exit
  fi
done

# ---- Decryption Progress ----
printf "\n"
center_text "Decrypting Fleet Database..."
sleep 0.5

printf "${SOFT_GREEN}"
printf "\n"
for i in {1..30}; do
  printf "▓"
  sleep 0.03
done
printf "${RESET}\n"

sleep 0.5
clear

# ---- Fleet Selection ----
printf "${SOFT_GREEN}"
center_text "WEYLAND-YUTANI FLEET REGISTRY"
printf "${RESET}\n"

OPTIONS=()

for cmd in fast2 thinkfast weyland1 cmdcentre cmdcentre-bridge stealth stealth2; do
  if command -v "$cmd" &> /dev/null; then
    OPTIONS+=("$cmd")
  fi
done

OPTIONS+=("CLASSIFIED PROJECT")
OPTIONS+=("Exit")

CHOICE=$(printf "%s\n" "${OPTIONS[@]}" | \
fzf --height=40% --layout=reverse --border --prompt="Select Vessel > ")

printf "\033[?25h"

case "$CHOICE" in
  CLASSIFIED\ PROJECT)
    read -sp "Secondary Clearance Code: " CODE
    echo
    if [[ "$CODE" == "LV426" ]]; then
      weyland1
    else
      echo "Clearance Denied."
      sleep 1.5
    fi
  ;;
  Exit)
    clear
  ;;
  *)
    if command -v "$CHOICE" &> /dev/null; then
      $CHOICE
    fi
  ;;
esac
